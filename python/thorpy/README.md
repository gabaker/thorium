# thorpy

A synchronous Python client for Thorium, derived from the Rust client
using [PyO3](https://docs.rs/pyo3/latest/pyo3/).

## Building

`uv` and `maturin` are recommended to build `thorpy`.

Install `uv` using your distro's package manager (or `brew` on Mac OS). Then install maturin
using `uv`:

```Bash
uv tool install maturin
```

If you haven't already, install a version of Python above 3.10:

```Bash
uv python install python3.12
```

Create a venv in the `thorpy` directory:

```Bash
uv venv --python 3.12
```

Now `maturin` will detect and use the version of Python linked to the set venv in the `.venv`
directory. To build the `thorpy` wheel, run:

```Bash
maturin build --release
```

To build `thorpy` and immediately install it to `.venv` for easy development and testing, run:

```Bash
maturin develop
```

### Generating Stubs

See the [thorpy-stubs docs](../thorpy-stubs/README.md) to generate the stubs file for
`thorpy`.

### Resources

- [maturin docs](https://www.maturin.rs/index.html)
- [PyO3 docs](https://docs.rs/pyo3/latest/pyo3/)

## Implemented Features

Only a very small portion of the Rust client has been implemented so far.
More functionality will be added over time!

### Basic

- identify
- health

### Reactions

- create
- create_bulk

## Caveats

### Type Info/Stubs

`pyo3` by default maps in the dynamic library generated by Cargo with _no_ type information.
Fortunately, PyO3 has experimental support for automatically generating these stub files by
enabling the `experimental-inspect` feature and using the
[pyo3-introspection crate](https://crates.io/crates/pyo3-introspection); the former produces
info in the dynamic library that the latter can then introspect into to produce a Python
stubs `.pyi` file.

We automatically generate and include this stubs file, but not all typing info is included.
Python language servers also seem to have trouble picking up typing info properly from
`PyO3` wheels. `pylance` fails to find class fields designated by the `@property` decorator.
`python-lsp-server` manages to find function documentation from the original Rust code and
will sometimes display the Rust function help rather than the stubs depending on the
request. `ty` seems to work the best of the options we've tried, but it's still in alpha,
so your mileage may vary.
